---
sidebar_position: 10
title: Rust
---

<a href="https://crates.io/crates/switchboard-v2">
  <img
    alt="Crates.io"
    src="https://img.shields.io/crates/v/switchboard-v2?label=switchboard-v2&logo=rust"
  />
</a>

import CodeBlock from "@theme/CodeBlock";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import RoundedCardGroup from "/src/components/RoundedCard/RoundedCardGroup";
import useBaseUrl from "@docusaurus/useBaseUrl";

A Rust library to interact with Switchboard V2 accounts on Solana.

## Quick Links

<RoundedCardGroup
  cols={2}
  items={[
    {
      to: "https://github.com/switchboard-xyz/sbv2-solana/tree/main/rust/switchboard-v2",
      title: "Github",
      description: "View the Github repo",
      image: <img src={useBaseUrl("/img/icons/github/light.svg")} />,
      imageDark: <img src={useBaseUrl("/img/icons/github/dark.svg")} />,
    },
    {
      to: "https://docs.rs/switchboard-v2/latest/switchboard_v2/",
      title: "Typedocs",
      description: "View the Typedocs",
      image: <img src={useBaseUrl("/img/icons/rust/crab.svg")} />,
      imageDark: <img src={useBaseUrl("/img/icons/rust/crab.svg")} />,
    },
  ]}
/>

## Install

To get started, add the
[switchboard-v2](https://crates.io/crates/switchboard-v2) crate to your
manifest.

```yaml
[dependencies]
switchboard-v2 = { version = "~0.1.19" }
```

## Features

| Feature | Description                                                                                           |
| ------- | ----------------------------------------------------------------------------------------------------- |
| devnet  | The devnet feature enables using the Switchboard Devnet Program ID instead of the Mainnet Program ID. |

Enable it in your Cargo.toml

```toml
[dependencies]
switchboard-v2 = { version = "~0.1.19", features = ["devnet"] }
```

### Define Your Own Devnet Feature

You can also define your own devnet feature to dynamically swap the program IDs.

```toml
[features]
default = []
devnet = ["switchboard-v2/devnet"]
```

This allows you to build your program with a feature flag to automate devnet and
mainnet builds.

```bash
# Build with Mainnet Switchboard Program ID
cargo build-bpf
# Build with Devnet Switchboard Program ID
cargo build-bpf --features devnet
```

## Data Feeds

### Read Latest Result

import ReadFeed from "!!raw-loader!/docs/solana/code/rust/read-feed.rs";
import ReadFeedPreview from "!!raw-loader!/docs/solana/code/rust/read-feed.preview.rs";

<Tabs>
  <TabItem value="preview" label="Preview">
    <CodeBlock language="rust">{ReadFeedPreview}</CodeBlock>
  </TabItem>
  <TabItem value="full" label="Full">
    <CodeBlock language="rust">{ReadFeed}</CodeBlock>
  </TabItem>
</Tabs>

**Example(s)**:

- [anchor-feed-parser](https://github.com/switchboard-xyz/sbv2-solana/blob/main/programs/anchor-feed-parser/src/lib.rs)
- [native-feed-parser](https://github.com/switchboard-xyz/sbv2-solana/blob/main/programs/native-feed-parser/src/lib.rs)

<hr />

### Read Aggregator History

import ReadFeedHistory from "!!raw-loader!/docs/solana/code/rust/read-feed-history.rs";
import ReadFeedHistoryPreview from "!!raw-loader!/docs/solana/code/rust/read-feed-history.preview.rs";

**_Note: The Aggregator must have a history buffer initialized before using_**

<Tabs>
  <TabItem value="preview" label="Preview">
    <CodeBlock language="rust">{ReadFeedHistoryPreview}</CodeBlock>
  </TabItem>
  <TabItem value="full" label="Full">
    <CodeBlock language="rust">{ReadFeedHistory}</CodeBlock>
  </TabItem>
</Tabs>

**Example(s)**:

- [anchor-history-parser](https://github.com/switchboard-xyz/sbv2-solana/blob/main/programs/anchor-history-parser/src/lib.rs)

<hr />

## VRF Account

### Read Latest Result

```rust
use switchboard_v2::VrfAccountData;

// deserialize the account info
let vrf = ctx.accounts.vrf.load()?;
// OR
let vrf = VrfAccountData::new(vrf_account_info)?;

// read the result
let result_buffer = vrf.get_result()?;
let value: &[u128] = bytemuck::cast_slice(&result_buffer[..]);
let result = value[0] % 256000 as u128;
```

**Example**:

- [anchor-vrf-parser](https://github.com/switchboard-xyz/sbv2-solana/blob/main/programs/anchor-vrf-parser/src/actions/update_result.rs)

### RequestRandomness CPI

```rust
pub use switchboard_v2::{VrfAccountData, VrfRequestRandomness};

let switchboard_program = ctx.accounts.switchboard_program.to_account_info();

let vrf_request_randomness = VrfRequestRandomness {
    authority: ctx.accounts.state.to_account_info(),
    vrf: ctx.accounts.vrf.to_account_info(),
    oracle_queue: ctx.accounts.oracle_queue.to_account_info(),
    queue_authority: ctx.accounts.queue_authority.to_account_info(),
    data_buffer: ctx.accounts.data_buffer.to_account_info(),
    permission: ctx.accounts.permission.to_account_info(),
    escrow: ctx.accounts.escrow.clone(),
    payer_wallet: ctx.accounts.payer_wallet.clone(),
    payer_authority: ctx.accounts.payer_authority.to_account_info(),
    recent_blockhashes: ctx.accounts.recent_blockhashes.to_account_info(),
    program_state: ctx.accounts.program_state.to_account_info(),
    token_program: ctx.accounts.token_program.to_account_info(),
};

let vrf_key = ctx.accounts.vrf.key.clone();
let authority_key = ctx.accounts.authority.key.clone();

let state_seeds: &[&[&[u8]]] = &[&[
    &STATE_SEED,
    vrf_key.as_ref(),
    authority_key.as_ref(),
    &[bump],
]];
msg!("requesting randomness");
vrf_request_randomness.invoke_signed(
    switchboard_program,
    params.switchboard_state_bump,
    params.permission_bump,
    state_seeds,
)?;

```

**Example**:

- [anchor-vrf-parser](https://github.com/switchboard-xyz/sbv2-solana/blob/main/programs/anchor-vrf-parser/src/actions/request_result.rs)

<hr />

## Buffer Relayer Account

### Read Latest Result

```rust
use anchor_lang::solana_program::clock;
use std::convert::TryInto;
use switchboard_v2::{BufferRelayerAccountData, SWITCHBOARD_PROGRAM_ID};

// check feed owner
let owner = *aggregator.owner;
if owner != SWITCHBOARD_PROGRAM_ID {
    return Err(error!(ErrorCode::InvalidSwitchboardAccount));
}

// deserialize account info
let buffer = BufferRelayerAccountData::new(feed_account_info)?;

// get result
let buffer_result = buffer.get_result();

// check if feed has been updated in the last 5 minutes
buffer.check_staleness(clock::Clock::get().unwrap().unix_timestamp, 300)?;

// convert buffer to a string
let result_string = String::from_utf8(buffer.result)
    .map_err(|_| error!(ErrorCode::StringConversionFailed))?;
msg!("Buffer string {:?}!", result_string);
```

**Example**:

- [anchor-buffer-parser](https://github.com/switchboard-xyz/sbv2-solana/blob/main/programs/anchor-buffer-parser/src/lib.rs)
