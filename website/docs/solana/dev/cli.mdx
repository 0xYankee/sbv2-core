---
sidebar_position: 8
title: Sbv2 CLI
---

import Print from "/docs/dev/cli/solana/print/index.md";
import QueueCreate from "/docs/dev/cli/solana/queue/create.md";
import OracleCreate from "/docs/dev/cli/solana/oracle/create.md";
import AggregatorCreate from "/docs/dev/cli/solana/aggregator/create.md";
import AggregatorAddJob from "/docs/dev/cli/solana/aggregator/add_job.md";
import AggregatorRemoveJob from "/docs/dev/cli/solana/aggregator/remove_job.md";

# Sbv2 solana

## Install

```bash npm2yarn
npm install -g @switchboard-xyz/cli^2
```

## Config

```bash
# Testnet
sbv2 config set solana devnet rpc https://devnet.genesysgo.net
sbv2 config set solana devnet default-account "~/.config/solana/id.json"

# Mainnet
sbv2 config set solana mainnet-beta rpc https://ssc-dao.genesysgo.net/
sbv2 config set solana mainnet-beta default-account "~/.config/solana/id.json"
```

## Usage

By default all commands will be run for devnet. You can change the cluster with
one of the following:

- `--mainnetBeta`, to connect to the mainnet-beta cluster
- `--cluster`, the cluster to connect to. options:
  devnet|mainnet-beta|mainnet|localnet

You can override the Switchboard programID with `--programId`.

You can set the RpcUrl in the config as shown above or override it with
`--rpcUrl`.

A keypair is required for all commands that submit on-chain transactions. The
payer keypair can be provided with one of the following flags. If the
transaction requires the account authority to sign which differs from the payer,
you may also provide `--authority` to point to an alternative authority keypair.

- `--keypair`, filesystem path or GCP secret manager path to a Solana keypair
  with sufficient funds to pay for on-chain transactions.
- `--ledger`, enable signing transactions with a ledger. Optionally, provide an
  alternative HID path with `--ledgerPath`.

You can run `--help` on any command to print the available flags and args.

## Examples

### Print an Account

```bash
sbv2 solana queue print "$QUEUE_KEY"
sbv2 solana crank print "$CRANK_KEY"
sbv2 solana oracle print "$ORACLE_KEY"
sbv2 solana aggregator print "$AGGREGATOR_KEY"
sbv2 solana vrf print "$VRF_KEY"
# print a mainnet job account
sbv2 solana job print "$JOB_KEY" --mainnetBeta
```

### Create a Queue

```bash
sbv2 solana queue create \
    --keypair ~/.config/solana/id.json \
    --queueAuthority ./queue_authority.json \
    --size 100 \
    --name "My Private Queue" \
    --metadata: "Top Secret" \
    --reward 0 \
    --minStake 0 \
    --oracleTimeout 300 \
    --slashingEnabled \
    --permissionedFeeds \
    --unpermissionedVrf \
    --enableBufferRelayers \
    --feedProbationPeriod 100 \
    --consecutiveFeedFailureLimit 500 \
    --consecutiveOracleFailureLimit 500
```

### Create an Oracle

```bash
sbv2 solana oracle create "$QUEUE_KEY" \
    --keypair ~/.config/solana/id.json \
    --name "My Oracle" \
    --stakeAmount 1.5 \
    --enable \
    --queueAuthority ./queue_authority.json
```

### Create a Feed

```bash
sbv2 solana aggregator create "$QUEUE_KEY" \
    --keypair ~/.config/solana/id.json \
    --crankKey "$CRANK_KEY" \
    --name "My_Test_Feed" \
    --updateInterval 10 \
    --minOracles 1 \
    --batchSize 1 \
    --leaseAmount 1.337 \
    --job ./directory/jobs/btc/binanceCom.jsonc \
    --job ./directory/jobs/btc/kraken.jsonc \
    --job ./directory/jobs/btc/bitfinex.jsonc \
    --enable \
    --queueAuthority ./queue_authority.json
```

### Modify a Feed

```bash
sbv2 solana aggregator set "$AGGREGATOR_KEY" \
    --keypair ~/.config/solana/id.json \
    --batchSize 5 \
    --minOracles 4 \
    --updateInterval 30 \
    --varianceThreshold 0.5 \
    --forceReportPeriod 300 \
    --basePriorityFee 100 \
    --priorityFeeBump 50 \
    --priorityFeeBumpPeriod 180 \
    --maxPriorityFeeMultiplier 10 \
```

### Request a Feed Update

```bash
sbv2 solana aggregator update "$AGGREGATOR_KEY" \
    --keypair ~/.config/solana/id.json
```

### Create a Network from a JSON File

```bash
sbv2 solana network create \
    --keypair ~/.config/solana/id.json \
    --configFile ./switchboard_network.json \
    --schemaFile ./switchboard_network.output.json \
    --cluster localnet
```

<details>
    <summary>
        JSON Example File
    </summary>

```json title="switchboard_network.json"
{
  "queue": {
    "name": "My Queue",
    "metadata": "Queue Metadata",
    "authorityKeypair": "./.keypairs/queueAuthority.json",
    "queueSize": 10,
    "reward": 0.000005,
    "minStake": 1,
    "oracleTimeout": 900,
    "unpermissionedFeeds": true,
    "unpermissionedVrf": "1",
    "enableBufferRelayers": "true"
  },
  "cranks": [
    {
      "name": "Crank #1",
      "maxRows": 200
    }
  ],
  "oracles": [
    {
      "name": "Oracle #1",
      "stakeAmount": 1.5,
      "enable": true,
      "authority": "./.keypairs/oracles/oracleAuthority1.json"
    },
    {
      "name": "Oracle #2",
      "stakeAmount": 1.5,
      "enable": true,
      "authority": "./.keypairs/oracles/oracleAuthority2.json"
    }
  ],
  "aggregators": [
    {
      "name": "Aggregator #1",
      "crankIndex": 0,
      "enable": true,
      "fundAmount": 1,
      "minUpdateDelaySeconds": 5,
      "batchSize": 3,
      "minRequiredOracleResults": 2,
      "basePriorityFee": 1000,
      "priorityFeeBump": 500,
      "priorityFeeBumpPeriod": 60,
      "maxPriorityFeeMultiplier": 10,
      "historyLimit": 1000,
      "jobs": [
        {
          "weight": 1,
          "name": "Job #1",
          "tasks": [
            {
              "valueTask": {
                "value": 1
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Aggregator #2",
      "crankIndex": 0,
      "enable": true,
      "fundAmount": 1,
      "minUpdateDelaySeconds": 5,
      "batchSize": 3,
      "minRequiredOracleResults": 2,
      "basePriorityFee": 2000,
      "priorityFeeBump": 500,
      "priorityFeeBumpPeriod": 60,
      "maxPriorityFeeMultiplier": 10,
      "historyLimit": 1000,
      "jobs": [
        {
          "weight": 1,
          "name": "Job #1",
          "tasks": [
            {
              "valueTask": {
                "value": 2
              }
            }
          ]
        }
      ]
    }
  ]
}
```

</details>

## Commands

import SolanaCli from "/docs/dev/cli/_solana.md";

<SolanaCli />
