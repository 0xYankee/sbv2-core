---
sidebar_position: 10
title: Oracle Queue
slug: /queue
---

Each oracle queue is independent and maintain their own configurations, which
dictates its degree of security. Queue's can require update requesters to be
pre-approved to use a queues resources or allow any requester access to a queue.
Queue's also specify a minimum stake oracles must maintain in their escrow
wallet before joining a queue, which acts as a deposit to incentivize honest
oracle behavior.

When creating a queue, an OracleQueueBuffer account must also be initialized
with a size of 8 Bytes + (32 Bytes Ã— `queue.maxSize`), where `queue.maxSize` is
the maximum number of oracles the queue can support. The OracleQueueBuffer
account `queue.dataBuffer` stores a list of oracle public keys in a round robin
fashion, using `queue.currIdx` to track its position on the queue for allocating
resource update request. Once a buffer is full, oracles must be removed before
new oracles can join the network. An oracle can be assigned to many update
request simultaneously but must continuously heartbeat on-chain to signal
readiness.

An oracle with **PermitOracleHeartbeat** permissions _MUST_ periodically
heartbeat on the queue to signal readiness, which adds the oracle to the queue
and allows it to be assigned resource update requests. Oracle positions are
periodically swapped in the OracleQueueBuffer account to mitigate oracles being
assigned the same update requests on each iteration of the queue.

The queue uses `queue.gcIdx` to track its garbage collection index. When an
oracle heartbeats on-chain, it passes the oracle account at index `queue.gcIdx`.
If the oracle account has failed to heartbeat before `queue.oracleTimeout`, it
is removed from the queue until its next successful heartbeat and will no longer
be assigned resource update requests.

## Economic Security

An oracle queue uses economic incentives to entice oracles to act honestly,
which dictate a queue's security model.

### Stake

The queue's `queue.minStake` is the raw token amount in the token mints base
unit (_Ex: lamports or satoshis_) required by an oracle to heartbeat on a queue.
If an oracle's staking wallet falls below the minStake requirement, it is
removed from the queue.

DeFi protocols with a significant Total Value Locked (TVL) should require
oracles with a higher minimum stake to fulfill their update request. Oracles
with a higher degree of _skin-in-the-game_ have a greater incentive to respond
honestly.

### Reward

The queue's specified `queue.reward` is the number of tokens an oracle or crank
turner receives for successfully completing an on-chain action. For a crank
turner this is turning the crank and invoking a data feed update. For an oracle
this is responding to an update request within the reliable margin from the
accepted result.

Queues should reward oracles enough such that the economic incentive over the
lifecycle of the feed exceeds the opportunity cost to attack a protocol
consuming the feed.

### Slashing

A queue may set `queue.slashingEnabled` to true in order to dissuade oracles
from responding to update request outside a set margin of error.

A queue's `queue.varianceToleranceMultiplier` determines how many standard
deviations an oracle must respond within before being slashed and forfeiting a
portion of their stake. [Defaults to 2 std deviations]

DeFi protocols with a significant TVL should require their feeds to be on a
queue with slashing enabled.

## Governance

An oracle queue can be governed by its network participants to control the
various queue configuration parameters, such as:

- `queue.minStake` - require a higher up-front cost for oracles to entice honest
  behavior
- `queue.reward` - control the oracle reward payout for successfully fulfilling
  update request
- `queue.slashingEnabled` - to disincentivize malicious oracle behavior
- Permit new oracles to join the network
